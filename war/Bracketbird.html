<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">


    <link type="text/css" rel="stylesheet" href="Bracketbird.css">
    <link type="text/css" rel="stylesheet" href="grid.css">

    <!--                                                               -->
    <!-- Consider inlining CSS to reduce the number of requested files -->
    <!--                                                               -->
    <link type="text/css" rel="stylesheet" href="Bracketbird.css">

    <!--                                           -->
    <!-- Any title is fine                         -->
    <!--                                           -->
    <link rel="shortcut icon" href="favicon.png">

    <title>Bracketbird</title>

    <!--                                           -->
    <!-- This script loads your compiled module.   -->
    <!-- If you add any GWT meta tags, they must   -->
    <!-- be added before this line.                -->
    <!--                                           -->
    <script type="text/javascript" language="javascript" src="bracketbird/bracketbird.nocache.js"></script>
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-12456452-8']);
        _gaq.push(['_trackPageview']);

        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>
    <script src='/_ah/channel/jsapi'></script>



</head>

<!--                                           -->
<!-- The body can have arbitrary html, or      -->
<!-- you can leave the body empty if you want  -->
<!-- to create a completely dynamic UI.        -->
<!--                                           -->
<body>

<!-- OPTIONAL: include this if you want history support -->
<iframe src="javascript:''" id="__gwt_historyFrame" tabIndex='-1'
        style="position:absolute;width:0;height:0;border:0"></iframe>
<div id="top"></div>
<div id="right"></div>

<div id="popup"></div>
<div id="note"></div>

<div id="panel"></div>
<div id="logpanel"></div>

<div id="logodiv"></div>

<script type="text/javascript">

    onOpened = function() {
        channelOpened();
    };

    onMessage = function(m) {
        messageRecieved(m.data);
    }

    onError = function() {
        errorRecieved();
    };

    onClose = function() {
        channelClosed();
    };


    openChannel = function(token) {
    	var channel = new goog.appengine.Channel(token);
    	var handler = {
    		'onopen': onOpened,
    		'onmessage': onMessage,
    		'onerror': onError,
    		'onclose': onClose,
    	};
    	var socket = channel.open(handler);
    }


</script>




<script type="text/javascript">

    function canvasSupport() {
    return Modernizr.canvas;
    }

    function canvasApp(id, color) {

    var theCanvas = document.getElementById(id);
    var context = theCanvas.getContext("2d");
    var displayWidth = theCanvas.width;
    var displayHeight = theCanvas.height;

    var lineColor;
    var lineWidth;

    fillColor = color;
    lineColor = color;


    var drawCount;

    drawRect(5,5,displayWidth-10,displayHeight-10,fillColor,lineColor);



    function clickListener(evt) {
    context.clearRect(0,0,theCanvas.width,theCanvas.height);
    generate();

    //code below prevents the mouse down from having an effect on the main browser window:
    if (evt.preventDefault) {
    evt.preventDefault();
    } //standard
    else if (evt.returnValue) {
    evt.returnValue = false;
    } //older IE
    return false;
    }

    function setLinePoints(iterations) {
    var pointList = {};
    pointList.first = {x:0, y:1};
    var lastPoint = {x:1, y:1}
    var minY = 1;
    var maxY = 1;
    var point;
    var nextPoint;
    var dx, newX, newY;
    var ratio;

    var minRatio = 0.33;

    pointList.first.next = lastPoint;
    for (var i = 0; i < iterations; i++) {
    point = pointList.first;
    while (point.next != null) {
    nextPoint = point.next;

    ratio = minRatio + Math.random()*(1 - 2*minRatio);
    newX = point.x + ratio*(nextPoint.x - point.x);

    //find the smaller interval
    if (ratio < 0.5) {
    dx = newX - point.x;
    }
    else {
    dx = nextPoint.x - newX;
    }

    newY = point.y + ratio*(nextPoint.y - point.y);
    newY += dx*(Math.random()*2 - 1);

    var newPoint = {x:newX, y:newY};

    //min, max
    if (newY < minY) {
    minY = newY;
    }
    else if (newY > maxY) {
    maxY = newY;
    }

    //put between points
    newPoint.next = nextPoint;
    point.next = newPoint;

    point = nextPoint;
    }
    }

    //normalize to values between 0 and 1
    if (maxY != minY) {
    var normalizeRate = 1/(maxY - minY);
    point = pointList.first;
    while (point != null) {
    point.y = normalizeRate*(point.y - minY);
    point = point.next;
    }
    }

    //unlikely that max = min, but could happen if using zero iterations. In this case, set all points equal to 1.
    else {
    point = pointList.first;
    while (point != null) {
    point.y = 1;
    point = point.next;
    }
    }

    return pointList;
    }


    function drawRect(x0,y0,w,h,lineColor,fillColor) {
    var cornerDrift = 3;
    var drawDriftX = 3;
    var drawDriftY = 3;
    var corner = [];
    var driftVector = [];
    var pointList;
    var i,j;
    var nextCorner;
    var iterates = 8;
    var nextX, nextY;
    var functionPoint;
    var endpointY;

    x0 += cornerDrift*(2*Math.random()-1);
    y0 += cornerDrift*(2*Math.random()-1);

    for (i = 0; i < 4; i++) {
    corner[i] = {};
    }

    corner[0].x = x0 + cornerDrift*(Math.random()*2 - 1);
    corner[0].y = y0 + cornerDrift*(Math.random()*2 - 1);

    corner[1].x = x0 + w + cornerDrift*(Math.random()*2 - 1);
    corner[1].y = y0 + cornerDrift*(Math.random()*2 - 1);

    corner[2].x = x0 + w + cornerDrift*(Math.random()*2 - 1);
    corner[2].y = y0 + h + cornerDrift*(Math.random()*2 - 1);

    corner[3].x = x0 + cornerDrift*(Math.random()*2 - 1);
    corner[3].y = y0 + h + cornerDrift*(Math.random()*2 - 1);

    driftVector[0] = {x:0, y:drawDriftY};
    driftVector[1] = {x:drawDriftX, y:0};
    driftVector[2] = {x:0, y:drawDriftY};
    driftVector[3] = {x:drawDriftX, y:0};

    //draw
    context.strokeStyle = lineColor;
    context.fillStyle = fillColor;
    context.lineWidth = 1;
    context.beginPath();
    context.moveTo(corner[0].x,corner[0].y);
    for (i = 0; i < 4; i++) {
    nextCorner = corner[(i + 1) % 4];
    pointList = setLinePoints(iterates);
    functionPoint = pointList.first;
    endpointY = functionPoint.y;
    while (functionPoint != null) {
    nextX = corner[i].x + functionPoint.x*(nextCorner.x - corner[i].x);
    nextY = corner[i].y + functionPoint.x*(nextCorner.y - corner[i].y);
    nextX += driftVector[i].x*(functionPoint.y - endpointY);
    nextY += driftVector[i].y*(functionPoint.y - endpointY);
    context.lineTo(nextX, nextY);
    functionPoint = functionPoint.next;
    }
    }
    context.stroke();
    context.fill();
    }
    }

</script>


<div id="audio"></div>

</body>
</html>
